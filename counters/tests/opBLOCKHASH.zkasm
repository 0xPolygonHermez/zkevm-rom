INCLUDE "../initIncludes.zkasm"

start:
    1000000 => GAS

operation:
    2       :HASHK1(0)
    10      :MSTORE(txCount)
    1       :MSTORE(SP++)
    ; close hash 0
    1       :HASHKLEN(0)
    $       :HASHKDIGEST(0)
            :JMP(opBLOCKHASH)

checkCounters:
%OPBLOCKHASH_STEP - STEP:JMPN(failedCounters)
%OPBLOCKHASH_CNT_BINARY - CNT_BINARY :JMPNZ(failedCounters)
%OPBLOCKHASH_CNT_ARITH - CNT_ARITH :JMPNZ(failedCounters)
; +1 due to hash(0)
%OPBLOCKHASH_CNT_KECCAK_F + 1 - CNT_KECCAK_F :JMPNZ(failedCounters)
%OPBLOCKHASH_CNT_MEM_ALIGN - CNT_MEM_ALIGN :JMPNZ(failedCounters)
%OPBLOCKHASH_CNT_PADDING_PG - CNT_PADDING_PG :JMPNZ(failedCounters)
%OPBLOCKHASH_CNT_POSEIDON_G - CNT_POSEIDON_G :JMPNZ(failedCounters)

0 => A,B,C,D,E,CTX, SP, PC, GAS, MAXMEM, SR, HASHPOS, RR ; Set all registers to 0
finalizeExecution:
                                                                        :JMP(finalWait)
readCode:
    :JMP(checkCounters)
failedCounters:
2 => A
1       :ASSERT
INCLUDE "../endIncludes.zkasm"